<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Gamsl 2</title>

    <link rel="stylesheet" href="styles/main.css" >
    <script rel="script" src="javascript/gamsl/gamsl.js"></script>
    <script rel="script" src="javascript/libs/jquery/jquery.js"></script>
    <script rel="script" src="javascript/libs/three.js/three.min.js"></script>
    <script rel="script" src="javascript/gamsl/utils/keys.js"></script>
    <script rel="script" src="javascript/gamsl/model/controls.js"></script>
    <script rel="script" src="javascript/gamsl/model/timer.js"></script>
    <script rel="script" src="javascript/gamsl/model/dummyCollisionSolver.js"></script>
    <script rel="script" src="javascript/gamsl/model/ObjectMover.js"></script>
    <script rel="script" src="javascript/gamsl/model/engine.js"></script>
    <script rel="script" src="javascript/gamsl/model/model.js"></script>
    <script rel="script" src="javascript/gamsl/model/player/player.js"></script>
    <script rel="script" src="javascript/gamsl/view/renderer.js"></script>
</head>
<body>

    <div id="web-gl-canvas"></div>

    <script>

    $(function(){



        var timer = new GAMSL.Timer();
        var engine = new GAMSL.Engine( timer );
        var model = new GAMSL.Model( engine );
        var renderer = new GAMSL.Renderer( timer, camera );

        var controls = new GAMSL.Controls( renderer.canvas );
        controls.registerKey("SPACE", " ".charCodeAt(0));

        var camera = renderer._camera;
        var light = new THREE.SpotLight( 0xFFFF00 );
        light.position.set( 10, 100, 10 );
        //renderer.addRenderable( light );

        engine.setControls(controls);

        var light = new THREE.AmbientLight( 0x404040 ); // soft white light
        renderer.addRenderable( light );

        var lights = [];
        lights[0] = new THREE.SpotLight( 0xffffff );
        lights[1] = new THREE.SpotLight( 0xffffff );
        lights[2] = new THREE.SpotLight( 0xffffff );

        lights[0].position.set( 0, 100, 0 );
        lights[1].position.set( 100, 100, 100 );
        lights[2].position.set( -100, +300, -100 );

        lights[0].castShadow = true;
        lights[0].shadowDarkness = 0.5;
        lights[1].castShadow = true;
        lights[1].shadowDarkness = 0.5;
        lights[2].castShadow = true;
        lights[2].shadowDarkness = 0.5 ;

        for(var i = 0; i< lights.length; i++){

            lights[i].shadowBias=0.004;
            lights[i].shadowCameraRight     =  10;
            lights[i].shadowCameraLeft     = -10;
            lights[i].shadowCameraTop      =  10;
            lights[i].shadowCameraBottom   = -10;
            lights[i].shadowMapWidth  = 1024;
            lights[i].shadowMapHeight  = 1024;

        }
//
//        lights[0].shadowCameraVisible = true;
//        lights[1].shadowCameraVisible = true;
//        lights[2].shadowCameraVisible = true;

        renderer.addRenderable( lights[0] );
        renderer.addRenderable( lights[1] );
        renderer.addRenderable( lights[2] );

        camera.position.set( 0, 10, 15 );
        camera.lookAt(new THREE.Vector3(0,0,0));



        var geometry = new THREE.BoxGeometry(50,1,50);
        var material = new THREE.MeshPhongMaterial( { color: 0x00ffff} );
        var mesh =  new THREE.Mesh( geometry, material );
        mesh.castShadow = true;
        mesh.receiveShadow = true;

        mesh.isAffectedByGravity = false;
        mesh.isMovable = false;
        mesh.isEnterable = false;
        mesh.onTouch = function ( o ){

            console.log( "touched with "+o );
            this.material = new THREE.MeshPhongMaterial( { color: 0xffff00} );

        };

//        mesh.rotateY(Math.PI/3);
//        mesh.rotateX(Math.PI/10);

        engine.registerObject(mesh);
        renderer.addRenderable(mesh);

        geometry = new THREE.BoxGeometry(6,1,4);
        material = new THREE.MeshPhongMaterial( { color: 0x00ffff} );
        mesh =  new THREE.Mesh( geometry, material );
        mesh.castShadow = true;
        mesh.receiveShadow = true;

        mesh.isAffectedByGravity = false;
        mesh.isMovable = false;
        mesh.isEnterable = false;
        mesh.onTouch = function ( o ){

            console.log( "touched with "+o );
            this.material = new THREE.MeshPhongMaterial( { color: 0xfff0f0 } );

        };

        mesh.rotateY(-Math.PI/3);
        mesh.rotateX(-Math.PI/10);
        mesh.position.x = 7;
        mesh.position.z = 7;

        engine.registerObject(mesh);
        renderer.addRenderable(mesh);


        geometry = new THREE.SphereGeometry( 1, 32, 32 );
        material = new THREE.MeshPhongMaterial({color: 0x000,metal:false})
        mesh =  new GAMSL.Player( geometry, material, camera );
        engine.addControlsListener(mesh);
        mesh.castShadow = true;


        mesh.position.y = 10;

        engine.registerObject(mesh);
        renderer.addRenderable(mesh);


        geometry = new THREE.BoxGeometry(10,10,10);
        material = new THREE.MeshPhongMaterial( { color: 0x00ffff} );
        mesh =  new THREE.Mesh( geometry, material );
        mesh.castShadow = true;
        mesh.receiveShadow = true;

        mesh.isAffectedByGravity = false;
        mesh.isMovable = false;
        mesh.isEnterable = false;
        mesh.onTouch = function ( o ){

            console.log( "touched with "+o );
            this.material = new THREE.MeshPhongMaterial( { color: 0xff00ff } );

        };

        mesh.position.x = -3;
        mesh.position.y = 1.5;
        mesh.position.z = 10;


        engine.registerObject(mesh);
        renderer.addRenderable(mesh);

        geometry = new THREE.BoxGeometry(10,20,10);
        material = new THREE.MeshPhongMaterial( { color: 0x00ffff} );
        mesh =  new THREE.Mesh( geometry, material );
        mesh.castShadow = true;
        mesh.receiveShadow = true;

        mesh.isAffectedByGravity = false;
        mesh.isMovable = false;
        mesh.isEnterable = false;
        mesh.onTouch = function ( o ){

            console.log( "touched with "+o );
            this.material = new THREE.MeshPhongMaterial( { color: 0xff0000 } );

        };

        mesh.position.x = 18;
        mesh.position.y = 1;
        mesh.position.z = 12;
       // mesh.rotateY(-Math.PI/3);


        engine.registerObject(mesh);
        renderer.addRenderable(mesh);


        model.start();

    });
    </script>

</body>
</html>