module.exports = (function(){

    console.log("Creating server module");

    var sender = null;
    var engine = null;
    var started = false;

    function start(){

        if( started ) return;

        if( sender != null && engine != null ) {

            console.log("Starting server tick");

            setInterval(function(){

                engine.tick( 16.6777 );

            }, 16.6777 );

            setInterval(function(){

                sender.sendAll( "serverState", engine.getState() );

            }, 50 );

            started = true;

        } else {

            console.log("ERROR: server parameters not set");

        }
    }

    function setSender( s ) {

        sender = s;

    }

    function setEngine( e ) {

        engine = e;

    }

    return {

        start: start,
        setSender: setSender,
        setEngine: setEngine

    };

})();
